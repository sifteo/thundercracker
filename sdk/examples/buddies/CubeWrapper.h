/* -*- mode: C; c-basic-offset: 4; intent-tabs-mode: nil -*-
 *
 * Copyright <c> 2012 Sifteo, Inc. All rights reserved.
 */

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

#ifndef SIFTEO_BUDDIES_CUBEWRAPPER_H_
#define SIFTEO_BUDDIES_CUBEWRAPPER_H_

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

#include <sifteo/cube.h>
#include "Config.h"
#include "Piece.h"

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

namespace Buddies {

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

class CubeWrapper
{
public:
    CubeWrapper();
    
    void Reset();
    void Paint();
    void Tick();
    void ForceFlush();
    
    bool IsSolved() const;
        
    void InitVideoRom();
    void PaintProgressBar();
    bool IsDoneLoading();
    
    bool IsEnabled() const;
    void Enable(Sifteo::Cube::ID cubeId, unsigned int buddyId);
    void Disable();
    
    unsigned int GetBuddyId() const;
    
    const Piece &GetPiece(unsigned int side) const;
    void SetPiece(unsigned int side, const Piece &piece);
    void SetPieceOffset(unsigned int side, int offset);
    
    BuddyMode GetMode() const;
    bool IsTouching() const;
    
    void PaintBanner(const Sifteo::AssetImage &asset);
    void PaintBannerScore(const Sifteo::AssetImage &asset, int minutes, int seconds);
    
private:
    Sifteo::VidMode_BG0_SPR_BG1 Video();
    
    void PaintPiece(const Piece &piece, unsigned int side);
    
    void OnButtonPress();
    void OnButtonRelease();
    
    Sifteo::Cube mCube;
    
    bool mEnabled;
    unsigned int mBuddyId;
    Piece mPieces[NUM_SIDES];
    Piece mPiecesSolution[NUM_SIDES];
    int mPieceOffsets[NUM_SIDES];
    BuddyMode mMode;
    bool mTouching;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

}

///////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////

#endif
